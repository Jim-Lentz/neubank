name: Terraform Destroy
on:
  workflow_dispatch:
    inputs:
      env:
        description: 'Environment'
        required: true
        default: 'dev'

jobs:
  destroy:
    name: "Destroy Azure"
    runs-on: ubuntu-latest
    steps:
#        - name: AWS Plan Copy
#          run: aws s3 cp s3://your-bucket/yourapp-${{ github.event.inputs.env }}.tfstate terraform.tfstate
#          id: copy
#          env:
#            AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
#            AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#            AWS_DEFAULT_REGION: ${{ secrets.REGION }}

#        - name: Show Destroy plan
#          run: terraform plan -destroy
#          continue-on-error: true
         - name: 'Set up Azure credentials'
           run: |
             echo "ARM_CLIENT_ID=${{ secrets.AZURE_CLIENT_ID }}" >> $GITHUB_ENV
             echo "ARM_CLIENT_SECRET=${{ secrets.AZURE_CLIENT_SECRET }}" >> $GITHUB_ENV
             echo "ARM_SUBSCRIPTION_ID=${{ secrets.AZURE_SUBSCRIPTION_ID }}" >> $GITHUB_ENV
             echo "ARM_TENANT_ID=${{ secrets.AZURE_TENANT_ID }}" >> $GITHUB_ENV
             
         - name: Destroy resources jobs
           id: destroy
           run: terraform destroy -auto-approve

 #       - name: Delete plan file
 #         if: steps.destroy.outcome == 'success'
 #         run: aws s3 rm s3://your-bucket/yourapp-${{ github.event.inputs.env }}.tfstate
 #         env:
 #           AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
 #           AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
 #           AWS_DEFAULT_REGION: ${{ secrets.REGION }}
